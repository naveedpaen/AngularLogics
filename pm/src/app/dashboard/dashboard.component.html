


<div class="container">
  <div class="row">
    <div class="col-xl-3 col-lg-6 col-xs-12">
      <div class="card">
        <div class="card-body">
          <div class="card-block">
            <div class="media">
              <div class="media-body text-xs-left">
                <h3 class="pink">{{totalClients}}</h3>
                <span>Total Clients</span>
              </div>
              <div class="media-right media-middle">
                <i class="material-icons pink font-large-2 float-xs-right">people_outline</i>
              </div>
            </div>
          </div>
        </div>
      </div> 
    </div>
    <div class="col-xl-3 col-lg-6 col-xs-12">
      <div class="card">
        <div class="card-body">
          <div class="card-block">
            <div class="media">
              <div class="media-body text-xs-left">
                <h3 class="teal">{{totalProjects}}</h3>
                <span>Total Projects</span>
              </div>
              <div class="media-right media-middle">
                <i class="material-icons  teal font-large-2 float-xs-right">card_travel</i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-lg-6 col-xs-12">
      <div class="card">
        <div class="card-body">    
          <div class="card-block">
            <div class="media">
              <div class="media-body text-xs-left">
                <h3 class="deep-orange">{{openProjects}}</h3>
                <span>Open Projects</span>
              </div>
              <div class="media-right media-middle">
                <i class="material-icons deep-orange font-large-2 float-xs-right">rounded_corner</i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-lg-6 col-xs-12">
      <div class="card">
        <div class="card-body">
          <div class="card-block">
            <div class="media">
              <div class="media-body text-xs-left">
                <h3 class="cyan">{{openTasks}}</h3>
                <span>Open Tasks</span>
              </div>
              <div class="media-right media-middle">
                <i class="material-icons cyan font-large-2 float-xs-right">view_week</i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<br>

<div *ngIf="showLoader" class="row">
    <mat-spinner [color]="color" class=" loaderclass"></mat-spinner>
    </div>
    <div>

<div class="container" >
  <div class="row">

    <div class="col-md-6 col-lg-8">
        <mat-toolbar style="background-color: #17a2b8; color: #ffffff; padding: 20px 20px 20px 20px;">
          <h2 style="color: #ffffff"> {{logedInUser}} Tasks</h2>
        </mat-toolbar>


        <!--.....................................       Table         ......................................-->
        <p-table [columns]="tableColumns" [(selection)]="selectedCar1" [value]="taskList" [customSort]="false" 
          [paginator]="false" [responsive]="true" sortField="Id" [lazy]="true"  [rowHover]="true"
          selectionMode="single" (onRowSelect)='openClickOnSpecificTask($event)'>
          <ng-template pTemplate="header" let-rowData let-columns >
            <tr>
              <th width="{{col.width}}" *ngFor="let col of columns" >
                {{col.header}}

              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-rowData let-task>
            <tr [pSelectableRow]="rowData">



                <td style="border: none">
                    <span > <img [src]="decideFlag(task.portalName)" height="20px" width:15px> </span>
                <span style="font-size: 18px; color: black">{{task.name}}</span>  
                <span class="pull-right">
                  <span  matTooltip="High Priority"  *ngIf="task.priorityName === 'High'" class="pull-right" style="color:red; padding-right: 15px;"><b>H</b></span>
                  <span  matTooltip="Medium Priority"  *ngIf="task.priorityName === 'Medium'" class="pull-right" style="color:#5de95d; padding-right: 14px;"><b>M</b></span>
                  <span  matTooltip="Low Priority"  *ngIf="task.priorityName === 'Low'" class="pull-right" style="color:#256dd8; padding-right: 17px;"><b>L</b></span>
                </span><br> &nbsp; &nbsp; &nbsp;
               
                 <span style="font-size: 12px"><span style="color: #5cb85c" matTooltip="Product">{{task.productName}}</span>  &nbsp; <strong>|</strong>
                  &nbsp;<span style="color:#42a7d0f7" matTooltip="Project">{{task.projectName}}</span>&nbsp; <strong>|</strong> &nbsp;<span  style="color:#e01c70" matTooltip="Accountant">{{task.accountantName}} </span>
                  <strong>|</strong> &nbsp; <span class="step"  matTooltip="Progress">{{task.progress}} </span> 
                </span>
              </td>

              <!-- <td style="border: none">
                  <span > <img [src]="decideFlag(task.portalName)" height="20px" width:15px> </span> 
                {{task.name}}
                <span class="pull-right">
                  <span matTooltip="High Priority" *ngIf="task.priorityName === 'High'" class="pull-right" style="color:red; padding-right: 15px;"><b>H</b></span>
                  <span matTooltip="Medium Priority" *ngIf="task.priorityName === 'Medium'" class="pull-right" style="color:#5de95d; padding-right: 14px;"><b>M</b></span>
                  <span matTooltip="Low Priority" *ngIf="task.priorityName === 'Low'" class="pull-right" style="color:#256dd8; padding-right: 17px;"><b>L</b></span>
                </span><br>
                &nbsp; &nbsp; &nbsp; <span style="font-size: 10px"> <span matTooltip="Product">{{task.productName}}</span> &nbsp; <strong>|</strong>
                  &nbsp;<span matTooltip="Project">{{task.projectName}}</span> &nbsp; <strong>|</strong> &nbsp; <span matTooltip="Accountant">{{task.accountantName}}</span>  &nbsp; <strong>|</strong> &nbsp; <span matTooltip="progress">{{task.progress}}</span></span>
              </td> -->





              <td style="border: none">
                <span [ngClass]="decideStatus(task.statusName)">{{task.statusName}}</span>
              </td> 
              <td style="border: none">{{task.startDate|date : "d/MM/y"}}
              </td>
            </tr>
          </ng-template>
        </p-table>
    </div>



        <!--....................             Activity                                 -->
    <div class="col-md-6 col-lg-4">
      <div class="card">
        <mat-toolbar style="background-color:#c80002" class="page-section-header">
          <h2 style="color: white">Activity</h2>
        </mat-toolbar>
        <br>
        <div class="card-block" style="  display: block;
        width: 100%;
        max-height:512px;
        overflow-y: scroll;">
          <div class="activity" *ngFor="let activity of activityList">
            <div class="active-user"><a href="0#"><img src="./assets/images/user-pic.jpg" alt=""></a></div>
            <div class="activity-detail">
              <p><span class="text_red">{{splitSummary(activity.summary)[0]}}</span>
                {{splitSummary(activity.summary)[1]}}
                <a href="#">{{splitSummary(activity.summary)[2]}}</a></p>

              <div class="date">{{splitSummary(activity.summary)[3]}}</div>
              <p>{{activity.description}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>




<!--...............................................                 Dialogue                      .................................-->

<p-dialog  [draggable]=false [modal]="true" [positionTop]='50' [(visible)]="showPopUp" [width]="800"  [contentStyle]="{'max-height':'700px' }"  >




    <p-header  ><strong style="color: #c82c00">{{name}}</strong>  &nbsp; &nbsp;
      <mat-icon (click)="edit()" class="text_red mat-icon material-icons" role="img" style="font-size:15px;cursor:pointer" aria-hidden="true">edit</mat-icon>
    </p-header>
  
    <!-- [style]="{background-color:#e0e0e0}" -->
  
    <div  class="container-fluid">
      <div class="row">
        <div class="col-md-8">
          <div class="col-md-12">
            <span><strong> Project : </strong> {{projectName}}</span>
          </div><br>
          <div class="col-md-12">
            <span> <strong> Product : </strong> {{productName}}</span>
          </div><br>
          <div class="col-md-12">
            <span> <strong>Assignee : </strong> {{assignedtoName}}</span>
          </div><br>
          <div class="col-md-12">
            <span> <strong>Created : </strong>{{ startDate|date : "d/MMMM/y"}}</span>
          </div><br>

          <div class="col-md-12">
          <span> <strong>Depends On : </strong>  
            <span (click) = 'onRowSelect2()' [ngClass]= "taskLinkCss"> {{parentName}}</span>
          </span>
        </div>

          <!-- <div class="col-md-12">
            <span> <strong>Depends On : </strong>{{parentName}}</span>
          </div><br> -->


        </div>
  
  
  
  
        <div class="col-md-4">
          <div class="col-md-12">
            <mat-menu #statusMenu="matMenu">
              <button (click)="onStatusChange(ct.id,ct.name)" mat-menu-item *ngFor="let ct of statusListDD" [value]="ct.id">
                {{ ct.name}}
              </button>
            </mat-menu>
            <span> <strong>Status : </strong>
              <span [ngClass]="decideStatus(statusName)" [matMenuTriggerFor]="statusMenu"> {{statusName}}  &nbsp; <i class="fa fa-caret-down"></i></span>
            </span>
          </div> <br>
  
          <div class="col-md-12">
            <span> <strong> Priority : </strong>&nbsp;
              <span>
                <span matTooltip="High Priority"  *ngIf="priorityName === 'High'" style="color:red; padding-right: 15px;"><b>H</b></span>
                <span matTooltip="Medium Priority" *ngIf="priorityName === 'Medium'" style="color:#5de95d; padding-right: 14px;"><b>M</b></span>
                <span matTooltip="Low Priority" *ngIf="priorityName === 'Low'" style="color:#256dd8; padding-right: 17px;"><b>L</b></span>
              </span>
            </span>
          </div> <br>
  
  
          <div class="col-md-12">
            <span> <strong>Country : </strong>

              <span > <img [src]="decideFlag(portalName)" height="20px" width:15px> </span> 
 
<!-- 
              <span *ngIf="portalName === 'United Kingdom'"> <img src="../../../assets/images/uk.png" height="20px"
                  width:15px> </span>
              <span *ngIf="portalName === 'Germany'"> <img src="../../../assets/images/germany.png" height="20px"
                  width:15px>
              </span>
              <span *ngIf="portalName === 'Netherlands'"> <img src="../../../assets/images/netherland.ico" height="20px"
                  width:15px> </span> -->
            </span>
          </div> <br>
  
  
          <div class="col-md-12">
            <span> <strong>Target : </strong>{{targetDate|date : "d/MMMM/y"}}</span>
          </div> <br>
        </div>
      </div> <br>


      <div class="col-12"  *ngIf= 'DonotShowOneTask'>
        <strong class="text_red">Tasks Dependencies:
          <hr></strong>
      
    <div class="row">
      <div (click)='goToTask(list)'   style="display: inline; cursor: pointer;" class="col-md-3 onhover" *ngFor= 'let list of dependencyTableList; let i=index'>  
        <!-- <span>index ={{i}}</span>  *ngIf = "i !== 0" -->
        <span  > 
            <span>{{list.name}} <br>
              <span style="font-size: 10px"> {{list.assignedtoName}}</span> &nbsp;  <span style="font-size: 8px" [ngClass]="decideStatus(list.statusName)">{{list.statusName}}</span>        
            </span>      
              </span> <br><br>
       </div>
      </div>
    </div><br>


    <div class="col-12">
        <strong class="text_red"> Task Items: <a  (click)='showSaveItemsPopUp()' ><i  style="background-color: white; color: green; cursor: pointer;" class="material-icons pull-right">add_box</i></a>  
          <hr></strong>         
          <!--      Task ITems Table ---------------------------------            -->
      <p-table [columns]="taskItemCols" [value]="taskItemList" [customSort]="false" [loading]="loading" [responsive]="true" [resizableColumns]="true"
     [rowHover]="false"   [paginator]="false" [lazy]="true"  >

      <ng-template pTemplate="header" let-rowData let-columns   class="ui-dialog-titlebar">
          <tr >
            <th [ngClass]="col.css" width="{{col.width}}"  *ngFor="let col of columns" [pSortableColumn]="col.field" pResizableColumn>
              {{col.header}}
            </th>
          </tr>
        </ng-template>
              <ng-template pTemplate="body" let-rowData let-task>
                <tr [pSelectableRow]="rowData" >
                      <td style="border: none">
                      <span>{{task.name}}</span>
                    </td>
                  <td style="border: none">
                      &nbsp; &nbsp; &nbsp; 
                      <mat-checkbox  (change) = 'updateTaskitemStatus(task)'    [checked]=task.isCompleted></mat-checkbox>
                      &nbsp; &nbsp; &nbsp;   &nbsp; 
                    <button mat-icon-button [matMenuTriggerFor]="menu">
                      <mat-icon>more_vert</mat-icon>
                    </button>
                    <mat-menu #menu="matMenu">
                      <button mat-menu-item  (click)="editTaskItem(rowData)">
                        <span class="actionmenu_list">
                          <mat-icon>mode_edit</mat-icon>
                          <span>Edit</span>
                        </span>
                      </button> 
      
                      <button mat-menu-item (click)="deleteItem(rowData)">
                        <span class="actionmenu_list">
                          <mat-icon>delete</mat-icon>
                          <span>Delete</span>
                        </span>
                      </button>
                    </mat-menu>
                  </td>
                </tr>
              </ng-template>
    </p-table>
        </div>  <br>
  
  
        <div class="col-11">
        <strong class="text_red">Description:
          <hr></strong>
        <span [innerHTML]="description"> </span>
      </div> <br><br>
  
          <div class="col-11">
        <strong class="text_red">Attachments:</strong>
        <hr>
  
  
        <div class="attachments">
          <div class="row">
            <div class="col-md-6" *ngFor="let attachment of attachmentList">
              <div class="row issue_attachments">
                <div class="col-md-4">
                  <img src="{{getAttachmentPath(attachment)}}" style=" border: 1px solid lightgray;  width: 80px;height: 80px;"
                    alt="">
                </div>
                <div class="col-md-8">
                  <div class="row">
                    <p style="font-size: 12px">
                      <a href="{{getAttachmentPath(attachment)}}" download>{{attachment.fileName}}</a>
                      <span> {{attachment.dT_Created | date:"d/MM/y hh:mm:ss"}}</span>
                    </p>
                  </div>
                </div>
              </div>
              <br>
            </div>
          </div>
        </div>


        
  
  
  
  
  <!--..................................................      Comments      ..........................................................-->
        <h4 class="page_title_1">Comments</h4>
        <div class="row">
          <div class="col-lg-12">
            <div class="col-md-12 ">
              <p-editor [(ngModel)]="parentComment" placeholder="Write Description Here" [style]="{'height':'150px'}"></p-editor>
            </div>
  
            <div class="col-lg-10 offset-2">
              <div class="button-row">
                <button style="background-color: red" mat-raised-button color="primary" class="pull-right" (click)="saveComment(0)">Comment</button>
              </div>
            </div>
            <br><br><br><br>
            <div class="col-lg-12">
              <div *ngFor="let i of CommentList">
                <div class="comment_parent">


               <!--........         Parent      -->
               <div class="row">
                  <div class="col-7">
                    <span class="comment_header" [innerHTML]="i.preview"> </span>
                  </div>
                  <div class="col-1">
          
                    </div>
                  <div class="col-4">
                    <span style="padding-top: 5px" class="pull-right">
                      <span style="font-size: 11px">{{i.userName}}</span><br>
                      <span style="font-size: 11px">{{i.dT_Created | date:"d/MM/y hh:mm"}}</span> &nbsp;
                      <mat-icon (click)="deleteComment(i.id)" class="text_red mat-icon material-icons pull-right" role="img" style="font-size:13px;cursor:pointer"
                      aria-hidden="true"><i style=" font-size: 13px;" class="material-icons">
                        delete
                      </i></mat-icon>
                    </span>
                  </div> 
                </div>
                <div class="row"> 
                  
                  <div class="col-md-8"> 
                    <mat-form-field class="removetopmargin">
                        <input matInput  [value]="childComment" placeholder="Reply here .." (blur)="childComment = $event.target.value">
                    </mat-form-field>
                  </div>  
                  
                  <div class="col-md-4">    
                      <br>
                    <button style="background-color: #5cb85a; min-width: 50px; line-height: 24px;" mat-mini-fab color="primary"
                    (click)="saveComment(i.id)" class="pull-right">Reply</button>
                  </div>
                </div>
              </div>
              <br><br>
  
                            <!--........         Child      -->
              <div class="col-lg-10 offset-2" *ngIf="i.issueComment.length > 0">
                <div *ngFor="let itemChild of i.issueComment;">
                  <div class="row"> 
                      <div class="col-9">
                          <span style="font-weight: 100; color: #800000"  [innerHTML]="itemChild.preview"></span>
                 
                        </div>
  
                  <div class="col-3" class="pull-right" style="font-size: 12px">
                    <span style="font-size: 11px"  >{{itemChild.userName}}</span><br>
                    <span style="font-size: 10px">{{itemChild.dT_Created | date:"d/MM/y hh:mm"}}</span> &nbsp;
                    <mat-icon (click)="deleteComment(itemChild.id)" class="text_red mat-icon material-icons pull-right" role="img" style="font-size:13px;cursor:pointer"
                    aria-hidden="true"><i style=" font-size: 13px;" class="material-icons">
                      delete
                    </i></mat-icon> 
                  </div>
                </div>
                <hr>
                </div>
              </div> 


                <br>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </p-dialog>


<!--...............................................  Completed  Time  Dialogue                   .................................-->

<p-dialog [draggable]=false [modal]="true" [positionTop]='150' [(visible)]="showHoursPopUp" [width]="300"  [contentStyle]="{'max-height':'300px' }"  >

    <p-header><strong style="color: #c82c00"> Time Spent </strong>
  
    </p-header>
    
    
    
    <div  class="container-fluid">
      <div class="row">
          <button style="color:white; background-color: white" mat-button></button>
  
        <div class="col-lg-12">
          <mat-form-field >
            <input #showError="ngModel" required pattern= "(.*)[0-9]{1}[A-Za-z]{1}"  matInput placeholder="eg. 3w 4d 2h" [(ngModel)]="TimeTaken" ngModel > 
          </mat-form-field>
  
               
          <div [hidden]="showError.valid" class="alert alert-danger">
            Please Enter like 3w or 4d or 2h
            </div>
  
  
        </div>
        <div class=" col-lg-12">
        <button [disabled]="!showError.valid"  (click)='UpdateCompletedTaskTime()' style="background-color: red" mat-raised-button color="primary" class="pull-right">Save</button>
        </div>
  
  
  
        </div>
      </div>
  
  
  
  
    </p-dialog>


  <!--...............................................   Task Items Dialogue                   .................................-->

  <p-dialog [draggable]=false [modal]="true" [positionTop]='150' [(visible)]="showTaskItemPopUp" [width]="400"  [contentStyle]="{'max-height':'300px' }"  >

      <p-header><strong style="color: #c82c00"> Task Items </strong>
    
      </p-header>
      
      
      
      <div  class="container-fluid">
        <div class="row">

            <button style="color:white; background-color: white" mat-button></button>
           <div class="col-md-12">
             <mat-form-field >
               <input [(ngModel)]= 'taskItemName' matInput placeholder="Task Item">
              </mat-form-field>
            </div>
  
                  <div *ngIf='showIsCompleted' class="col-md-12">               
                    <mat-checkbox [(ngModel)]='isCompleted'>Is Completed</mat-checkbox>
                  </div>
  
  
          </div>
        </div>
        <div class="button-row">
            <button (click)= 'saveTaskItems()' style="background-color: red" mat-raised-button color="primary" class="pull-right">Save</button>
        </div>
    
    
    
      </p-dialog>


      <div *ngIf='showDetailComponent'>
        <app-taskdetail (eventToCallParentComponentMethod)="grid()" [id]='taskIdOfParentComponent'></app-taskdetail>
      </div> 