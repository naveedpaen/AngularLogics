<!-- <mat-toolbar style="background-color:#c80002" class="page-section-header">
  <h2 style="color: white">Add Task</h2>
</mat-toolbar> -->


<mat-toolbar class="page-section-header">
    <h2>Add Task</h2>
  </mat-toolbar>


<form [formGroup]='formGroup' (ngSubmit)="save(formGroup.value)">
  <mat-card>


      <div class="panel panel-default">
          <div class="panel-body">
    
                 <div *ngIf="showLoader" >
                  <mat-spinner [color]="color" class=" loaderclass"></mat-spinner>
                  </div>

                  <div>
                  <div class="row">
                    <div class="col-lg-12">
                        <div class="row">


        <div class=" col-lg-12">
          <mat-form-field>
            <input matInput placeholder="Task Name" formControlName="name">
          </mat-form-field>
        </div>

        <div class=" col-lg-4">
          <mat-form-field>
            <mat-select placeholder="Select Portal" (change)='onPortalChange()' formControlName="portalId">
              <mat-option *ngFor="let portals of portalList" [value]="portals.id">
                {{portals.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>





        <div class="col-lg-4">
          <mat-form-field>
            <mat-select placeholder="Select Project" (change)='onProjectChange()' formControlName="projectId">
              <mat-option *ngFor="let projects of projectList" [value]="projects.id">
                {{projects.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>





        <div class=" col-lg-4">
          <mat-form-field>
            <mat-select placeholder="Select Product" (change)='onProductChange()' formControlName="productId">
              <mat-option *ngFor="let product of productList" [value]="product.id">
                {{product.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>



        <div class=" col-lg-4 ">
          <mat-form-field>
            <mat-select placeholder="Select Assigned To" formControlName="assignedToId">
              <mat-option *ngFor="let assigned of assignedList" [value]="assigned.id">
                {{assigned.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>




        <div class=" col-lg-4">
          <mat-form-field>
            <mat-select placeholder="Select Prority" formControlName="priorityId">
              <mat-option *ngFor="let priority of priorityList" [value]="priority.id">
                {{ priority.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>


        <div class="col-lg-4">
          <mat-form-field>
            <input matInput [matDatepicker]="picker2" placeholder="Target Date" formControlName="targetDate">
            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
            <mat-datepicker #picker2></mat-datepicker>
          </mat-form-field>
        </div>



        <div class="col-md-4">
          <mat-form-field>
          <mat-select  placeholder="Dependent" (change)='onYesOrNoChange()' formControlName="selectedYesOrNot">
          <mat-option *ngFor="let ct of dependentList" [value]="ct.id">
          {{ ct.title }}
          </mat-option>
          </mat-select>
          </mat-form-field>
          </div>



          <div class="col-md-4" *ngIf='showDependent'>
            <mat-form-field>
            <mat-select   placeholder="Select Task" formControlName="parentId">
            <mat-option *ngFor="let ct of taskList" [value]="ct.id">
            {{ ct.name }}
            </mat-option>
            </mat-select>
            </mat-form-field>
            </div>

        <!-- <div class="col-lg-4" *ngIf='showStatus'>
          <mat-form-field>
            <mat-select placeholder="Select Status" formControlName="statusId">
              <mat-option *ngFor="let status of statusList" [value]="status.id">
                {{status.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div> -->


        

      <br>



        <div class="col-md-12">
          <strong class="text_red">Description:</strong>
          <p-editor formControlName="description" [style]="{'height':'220px'}"></p-editor>
        </div>

      <br>

        <div class="col-md-12">
          <br>
          <br>
          <strong class="text_red">Attachments:</strong>
          <hr>
          <br>
          <br>
          <div class="row" *ngIf="taskId!==0">




            <div class="col-md-4" *ngFor="let attachment of attachmentList">
              <div class="issue_attachments">
                <button mat-icon-button (click)="removeAttachment(attachment.id)">
                  <mat-icon style="margin-top: -15px;">close</mat-icon>
                </button>
                <img src="{{getAttachmentPath(attachment)}}" style="height: 114px;width: 114px;border: 1px solid lightgray;"
                  alt="">
                <p>
                  <a href="{{getAttachmentPath(attachment)}}" download>{{attachment.fileName}}</a>
                  <span> {{attachment.dT_Created | date:"dd/MM/yyyy hh:mm:ss a"}}</span>
                </p>
              </div>
            </div>

          </div>
        </div>



        <div class="col-md-12">
          <p-fileUpload name="myfile[]" #fileInput [url]="uploadUrl" accept="image/*,.pdf,.txt,.xls,.csv,.xlsx,.doc,.docx,.ppt,.pptx"
             (onUpload)="onUpload($event)" (onBeforeSend)="beforeUpload($event)" (onError)="uploadError($event)"
             auto="auto"  multiple="multiple" maxFileSize="25000000">


            <ng-template pTemplate="toolbar">
              <mat-progress-bar mode="query" color="warn" *ngIf="uploadProgress"></mat-progress-bar>
            </ng-template>
            <ng-template pTemplate="content">
              <ul *ngIf="uploadedFiles.length">
                <li *ngFor="let file of uploadedFiles">{{file.fileName}}</li>
              </ul>
            </ng-template>
          </p-fileUpload>
        </div>


      <br>
      <br>
      <br>

        <div class="button-row">
          <button style="background-color: red" mat-raised-button color="primary" class="pull-right">Save</button>
          <button mat-raised-button class="pull-right">Cancel</button>
        </div>






 

    </div>
    </div>
  </div>
</div>
</div>
</div>




  </mat-card>
</form>




